<!DOCTYPE html>
<html>
<head>
	<title>Contacts List</title>
</head>
<body>
	<div id="react-app"></div>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/react/15.0.1/react.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/react/15.0.1/react-dom.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/babel-core/5.6.16/browser.js"></script>
	<script type="text/babel">
	var Contacts = [
		{key: 1, name: "James K Nelson", email: "james@jamesknelson.com", description: "Front-end Unicorn"},
		{key: 2, name: "Jim", email: "jim@example.com"},
		{key: 3, name: "Joe"},
	];

	var Contact = React.createClass({
		deleteContact: function() {
			console.log("Delete");
			this.props.Delete(this.props.contact);
		},
		contactEdit: function() {
			console.log("Edit");
			this.props.Edit(this.props.contact);
		},
		render: function(){
			return (<div>
					<h2>{this.props.contact.name}</h2>
					<a href='mailto:{this.props.contact.email}'>{this.props.contact.email}</a>
					<p>{this.props.contact.description}</p>
					<button onClick={this.contactEdit}> Edit </button>
					<button onClick={this.deleteContact}> Delete </button>
				</div>);
		}
	});

	var ContactList = React.createClass({
		render: function(){
			var self=this; 		//To avoid error with 'this' inside map function
			return(
				<ul>{Contacts.filter(function(contact){return contact.email})
					.map(function(contact){
						return <Contact contact={contact} Delete={self.props.Delete} Edit={self.props.Edit}/>
					})}
				</ul>
			)
		}
	});

	var ContactForm = React.createClass({
		getInitialState: function(){
			if (this.props.EditContact === {}) {
				return{
					name:"",
					email:"",
					description:"",
				};
			}
			else{
				return{
					name:this.props.EditContact.name,
					email:this.props.EditContact.email,
					description:this.props.EditContact.description,
				};
			}
		},
		nameChange: function(event){
			this.setState({name:event.target.value});
		},
		emailChange: function(event){
			this.setState({email:event.target.value});
		},
		descChange: function(event){
			this.setState({description:event.target.value});
		},
		contactSubmit: function(event){
			event.preventDefault();
			var name = this.state.name.trim();
			var email = this.state.email.trim();
			if (!name || !email) {
				return;
			}
			this.props.Submit({name:this.state.name, email:this.state.email, description:this.state.description,});
			this.setState({name:"",email:"",description:"",});
		},
		render: function(){
			return(
				<form onSubmit={this.contactSubmit}>
					<input type="text" placeholder="Name" value={this.state.name} onChange={this.nameChange} required/><br/>
					<input type="email" placeholder="Email" value={this.state.email} onChange={this.emailChange} required /><br/>
					<textarea type="text" placeholder="Description" value ={this.state.description} onChange={this.descChange} /><br/>
					<button type="submit">Add contact</button>
				</form>
			);
		}
	})

	var Root = React.createClass({
		EditContact: {},
		getInitialState: function(){
			return {Contacts:Contacts};
		},
		Submit: function(contact) {
			this.setState({Contacts:Contacts.push(contact)});
		},
		Edit: function (contact) {
			this.EditContact = contact;
		},
		SubmitEdit: function(contact){
			Contacts = Contacts.map(function(cntct){
				if (cntct === this.EditContact){
					return contact;
				}
				else{
					return cntct;
				}
			});
			this.setState({Contacts:Contacts});
		},
		Delete: function(contact) {
			Contacts = Contacts.filter(function(cntct){
				return cntct !== contact;
			});
			this.setState({Contacts:Contacts});
		},
		render:function(){
			return(
			<div>
			<h1>Contacts</h1>
			<ContactList Edit={this.Edit} Delete={this.Delete} />
			<ContactForm Submit={this.Submit} EditContact={this.EditContact} SubmitEdit={this.SubmitEdit} />
		</div>);
		}
	});

	ReactDOM.render(<Root/>,document.getElementById("react-app"));
	</script>
</body>
</html>
