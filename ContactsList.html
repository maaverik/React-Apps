<!DOCTYPE html>
<html>
<head>
	<title>Contacts List</title>
</head>
<body>
	<div id="react-app"></div>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/react/15.0.1/react.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/react/15.0.1/react-dom.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/babel-core/5.6.16/browser.js"></script>
	<script type="text/babel">
	var Contacts = [
		{key: 1, name: "John Smith", email: "john@johnandsmith.com", description: "Sales Dept;  Cell: 7459633286"},
		{key: 2, name: "Jim", email: "jim@qwerty.com", description:''},
	];

	var Contact = React.createClass({
		deleteContact: function() {
			this.props.Delete(this.props.contact);
		},
		contactEdit: function() {
			this.props.Edit(this.props.contact);
		},
		render: function(){
			return (<div>
					<h2>{this.props.contact.name}</h2>
					<a href='mailto:{this.props.contact.email}'>{this.props.contact.email}</a>
					<p>{this.props.contact.description}</p>
					<button onClick={this.contactEdit}> Edit </button>
					<button onClick={this.deleteContact}> Delete </button>
				</div>);
		}
	});

	var ContactList = React.createClass({
		render: function(){
			var self=this; 		//To avoid error with 'this' inside map function
			return(
				<ul>
				{self.props.Contacts.map(function(contact){
						return (
							<Contact contact={contact} Delete={self.props.Delete} Edit={self.props.Edit}/>
						)
					})
				}
				</ul>
			)
		}
	});

	var ContactForm = React.createClass({
		getInitialState: function(){
			return{
				name:"",
				email:"",
				description:"",
				buttonText: 'Add Contact',
			};
		},
		Editing:  false,
		nameChange: function(event){
			this.setState({name:event.target.value});
		},
		emailChange: function(event){
			this.setState({email:event.target.value});
		},
		descChange: function(event){
			this.setState({description:event.target.value});
		},
		contactSubmit: function(event){
			event.preventDefault();
			if (!this.Editing){
				var name = this.state.name.trim();
				var email = this.state.email.trim();
				if (!name || !email) {
					return;
				}
				this.props.Submit({name:this.state.name, email:this.state.email, description:this.state.description,});
			}
			else{
				this.props.SubmitEdit({name:this.state.name, email:this.state.email, description:this.state.description,});
				this.Editing = false;
			}
			this.setState({name:"",email:"",description:"",buttonText:"Add contact"});
		},
		contactEdit: function(){
			this.Editing = true;
			this.setState({
					name:this.props.EditContact.name,
					email:this.props.EditContact.email,
					description:this.props.EditContact.description,
					buttonText: 'Edit Contact',
			});
		},
		render: function(){
			if (Object.keys(this.props.EditContact).length > 0 && (this.state.name !== this.props.EditContact.name && this.state.email !== this.props.EditContact.email)) {
				this.contactEdit();
			}
			return(
				<form onSubmit={this.contactSubmit}>
					<input type="text" placeholder="Name" value={this.state.name} onChange={this.nameChange} required/><br/>
					<input type="email" placeholder="Email" value={this.state.email} onChange={this.emailChange} required /><br/>
					<textarea type="text" placeholder="Description" value ={this.state.description} onChange={this.descChange} /><br/>
					<button type="submit">{this.state.buttonText}</button>
				</form>
			);
		}
	})

	var Root = React.createClass({
		getInitialState: function(){
			return {Contacts:Contacts, EditContact:{}};
		},
		Submit: function(contact) {
			Contacts.push(contact);
			this.setState({Contacts:Contacts});
		},
		Edit: function (contact) {
			this.setState({EditContact:contact});
		},
		SubmitEdit: function(contact){
			var self = this;
			Contacts = Contacts.map(function(cntct){		//Fix this
				if (cntct === self.state.EditContact){
					return contact;
				}
				else{
					return cntct;
				}
			});
			this.setState({Contacts:Contacts});
			this.setState({EditContact:{}});
		},
		Delete: function(contact) {
			Contacts = Contacts.filter(function(cntct){
				return cntct !== contact;
			});
			this.setState({Contacts:Contacts});
		},
		render:function(){
			return(
				<div>
				<h1>Contacts</h1>
				<ContactList Contacts={this.state.Contacts} Edit={this.Edit} Delete={this.Delete} />
				<ContactForm Submit={this.Submit} EditContact={this.state.EditContact} SubmitEdit={this.SubmitEdit} />
				</div>
			);
		}
	});

	ReactDOM.render(<Root/>,document.getElementById("react-app"));
	</script>
</body>
</html>
